{% extends 'base.html.twig' %}

{% block title %}Post
{% endblock %}

{% block body %}
	<div class="row">
		<div class="col-12 col-lg-8">
			<div class="card shadow-sm mb-4">
				<div class="card-body">
					<h1 class="card-title h3 mb-4">{{ post.title }}</h1>
					<p class="text-muted mb-3">
						<small>
							<strong>ID:</strong>
							{{ post.id }}
							|
							<strong>Published:</strong>
							{{ post.publishedAt ? post.publishedAt|date('Y-m-d H:i') : 'Not published' }}</small>
					</p>

					{% if post.picture %}
						<div class="mb-4">
							<img src="{{ post.picture }}" alt="{{ post.title }}" class="img-fluid rounded">
						</div>
					{% endif %}

					<div class="card-text">
						<h5 class="mb-2">Content</h5>
						<p>{{ post.content }}</p>
					</div>
				</div>
			</div>

			<div class="card shadow-sm">
				<div class="card-header d-flex justify-content-between align-items-center">
					<h5 class="mb-0">Comments
						<span class="badge bg-secondary ms-2">{{ comments|length }}</span>
					</h5>
					{% if app.user %}
						<a href="{{ path('app_comment_new') }}" class="btn btn-sm btn-primary">Add comment</a>
					{% endif %}
				</div>

				<div class="list-group list-group-flush">
					{% for comment in comments %}
						<div class="list-group-item">
							<div class="d-flex w-100 justify-content-between">
								<h6 class="mb-1">{{ comment.author|default(comment.user.userIdentifier|default('Anonymous')) }}</h6>
								<small class="text-muted">{{ comment.createdAt ? comment.createdAt|date('Y-m-d H:i') : '' }}</small>
							</div>
							<p class="mb-1">{{ comment.content }}</p>
							<div class="mt-2">
								<a href="{{ path('app_comment_show', {'id': comment.id}) }}" class="btn btn-sm btn-outline-secondary me-1">Show</a>
								{% if app.user and app.user.roles[0] == 'ROLE_ADMIN' %}
									<a href="{{ path('app_comment_edit', {'id': comment.id}) }}" class="btn btn-sm btn-warning">Edit</a>
								{% endif %}
							</div>
						</div>
					{% else %}
						<div class="list-group-item text-center py-4">No comments yet</div>
					{% endfor %}
				</div>
			</div>

		</div>

		<div class="col-12 col-lg-4">
			<div class="card shadow-sm">
				<div class="card-header bg-light">
					<h5 class="mb-0">Actions</h5>
				</div>
				<div class="card-body">
					<div class="d-grid gap-2">
						{% if app.user and app.user.roles[0] == 'ROLE_ADMIN' %}
							<a href="{{ path('app_post_edit', {'id': post.id}) }}" class="btn btn-warning">
								<i class="bi bi-pencil"></i>
								Edit</a>
						{% endif %}
						<a href="{{ path('app_post_index') }}" class="btn btn-secondary">
							<i class="bi bi-arrow-left"></i>
							Back to list</a>
					</div>
				</div>
			</div>

			{% if app.user and app.user.roles[0] == 'ROLE_ADMIN' %}
				<div class="card shadow-sm mt-3 border-danger">
					<div class="card-header bg-danger text-white">
						<h5 class="mb-0">Danger Zone</h5>
					</div>
					<div class="card-body">
						{{ include('post/_delete_form.html.twig') }}
					</div>
				</div>
			{% endif %}
		</div>
	</div>
{% endblock %}
