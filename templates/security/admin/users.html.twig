{% extends 'base.html.twig' %}

{% block title %}
	Gestion utilisateurs
{% endblock %}

{% block body %}

	<div class="d-flex justify-content-between align-items-center mb-3">
		<div>
			<h1 class="h3 mb-0">
				<i class="bi bi-people-fill"></i>
				Gestion utilisateurs</h1>
			<small class="text-muted">Total:
				<span class="badge bg-secondary">{{ users|length }}</span>
			</small>
		</div>
	</div>

	<div class="card shadow-sm">
		<div class="card-body p-0">
			<div class="table-responsive">
				<table class="table table-hover align-middle mb-0">
					<thead class="table-light">
						<tr>
							<th style="width: 5%;">Id</th>
							<th style="width: 10%;">User</th>
							<th style="width: 25%;">Email</th>
							<th style="width: 15%;">Rôle</th>
							<th style="width: 20%;">Status</th>
							<th style="width: 15%;">Created</th>
							<th style="width: 15%;">Actions</th>
						</tr>
					</thead>
					<tbody>
						{% for user in users %}
							<tr>
								<td>
									<strong>{{ user.id }}</strong>
								</td>
								<td>
									<div class="d-flex align-items-center gap-3">
										<div>
											<strong>{{ user.lastName }}
												{{ user.firstName }}</strong>
										</div>
									</div>
								</td>
								<td>
									<strong>{{ user.email }}</strong>
								</td>
								<td>
									{% set role = user.roles[0]|default('ROLE_USER') %}
									<span class="badge bg-info">{{ role }}</span>
								</td>
								<td>
									{% if user.statut == 'ACTIF' %}
										<span class="badge bg-success">
											<i class="bi bi-check-circle"></i>
											Actif</span>
									{% else %}
										<span class="badge bg-secondary">
											<i class="bi bi-slash-circle"></i>
											Inactif</span>
									{% endif %}
								</td>
								<td>
									{% if user.createdAt %}
										<small class="text-muted">{{ user.createdAt|date('Y-m-d') }}</small>
									{% else %}
										<small class="text-muted">—</small>
									{% endif %}
								</td>
								<td>
									{% if user.roles[0] != 'ROLE_ADMIN' %}
										<div class="btn-group" role="group">
											{% if user.statut == 'ACTIF' %}
												<a href="{{ path('app_user_toggle', {'id': user.id}) }}" class="btn btn-sm btn-outline-danger" title="Deactivate">Désactiver</a>
											{% else %}
												<a href="{{ path('app_user_toggle', {'id': user.id}) }}" class="btn btn-sm btn-outline-success" title="Activate">Activer</a>
											{% endif %}
										</div>
									{% endif %}
								</td>
							</tr>
						{% else %}
							<tr>
								<td colspan="6" class="text-center py-5">
									<i class="bi bi-people display-6 text-muted d-block mb-2"></i>
									<span class="text-muted">Aucun utilisateur trouvé.</span>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	</div>

{% endblock %}
